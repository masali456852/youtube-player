https://cdn.jsdelivr.net/npm/hls.js@latest

<script>
async function loadVideo() {
    const input = document.querySelector("input");
    const url = input.value.trim();
    const msg = document.querySelector(".msg");
    const playerBox = document.querySelector(".player");
    const iframeBox = document.querySelector(".ratio");
    const dlBox = document.querySelector(".dl-box");
    const dlList = document.querySelector(".dl-list");

    if (!url) {
        msg.innerHTML = "<span class='err'>⚠️ الرجاء إدخال رابط فيديو</span>";
        return;
    }

    msg.innerHTML = "";
    playerBox.style.display = "block";
    dlBox.style.display = "block";

    // إزالة iframe القديم
    iframeBox.innerHTML = "";

    // إنشاء عنصر فيديو
    let videoEl = document.createElement("video");
    videoEl.controls = true;
    videoEl.style.width = "100%";
    videoEl.style.height = "100%";

    iframeBox.appendChild(videoEl);

    // لو الرابط M3U8
    if (url.endsWith(".m3u8")) {
        if (Hls.isSupported()) {
            let hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(videoEl);
        } else {
            videoEl.src = url;
        }
    } else {
        // روابط MP4 / WebM
        videoEl.src = url;
    }

    // ------- إنشاء روابط التحميل --------
    const qualities = [
        { label: "1080p", q: "1080" },
        { label: "720p",  q: "720" },
        { label: "480p",  q: "480" },
        { label: "360p",  q: "360" },
    ];

    dlList.innerHTML = "";

    qualities.forEach(q => {
        // تخمين روابط الجودات عبر استبدال الرقمية – مثل سيرفرات كثيرة تسمح بهذا
        let qUrl = url.replace(/(\d+)(p)?/i, q.q + "p");

        let row = `
        <div class="dl-item">
            <div class="dl-left">
                <span class="badge video">فيديو</span>
                <span class="meta">جودة ${q.label}</span>
            </div>
            ${qUrl}تحميل</a>
        </div>`;

        dlList.innerHTML += row;
    });

    // زر تحميل بنفس الرابط الأصلي
    dlList.innerHTML += `
    <div class="dl-item">
        <div class="dl-left">
            <span class="badge video">أصلي</span>
            <span class="meta">الرابط كما هو</span>
        </div>
        ${url}تحميل</a>
    </div>`;
}
</script>
