<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تشغيل يوتيوب داخل الصفحة</title>
  <style>
    body{font-family:Tahoma,Arial,sans-serif;background:#0b1020;color:#fff;margin:0;padding:20px}
    .box{max-width:900px;margin:auto;background:#121a33;border:1px solid rgba(255,255,255,.15);border-radius:14px;padding:16px}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(0,0,0,.25);color:#fff;outline:none}
    button{margin-top:10px;padding:11px 14px;border-radius:10px;border:0;background:#5b8cff;color:#07102a;font-weight:700;cursor:pointer}
    .msg{margin-top:10px;color:#a9b3d6;font-size:13px;line-height:1.8}
    .err{color:#ff5b6a}
    .player{margin-top:14px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.15);background:#000}
    .ratio{position:relative;padding-top:56.25%}
    iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
  </style>
</head>
<body>
  <div class="box">
    <h3 style="margin:0 0 10px">ضع رابط يوتيوب ثم اضغط تشغيل</h3>

    <!-- لاحظ: لا يوجد form حتى لا يحدث reload -->
    <input id="ytInput" placeholder="مثال: https://youtu.be/dQw4w9WgXcQ" />
    <button id="playBtn" type="button">تشغيل</button>

    <div id="status" class="msg">جاهز…</div>

    <div class="player">
      <div class="ratio">
        <iframe id="ytFrame"
          title="YouTube Player"
          loading="lazy"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <script>
    // اختبار سريع: إذا رأيت هذه الرسالة في Console فمعناه السكربت يعمل
    console.log("JS Loaded ✅");

    const input  = document.getElementById("ytInput");
    const btn    = document.getElementById("playBtn");
    const status = document.getElementById("status");
    const frame  = document.getElementById("ytFrame");

    function setStatus(text, isError=false){
      status.textContent = text;
      status.className = isError ? "msg err" : "msg";
    }

    function extractId(raw){
      const text = (raw || "").trim();
      if(!text) return null;

      // إذا المستخدم كتب ID فقط (11 حرف غالبًا)
      if(/^[a-zA-Z0-9_-]{11}$/.test(text)) return text;

      // حاول تحويل النص إلى URL
      let urlText = text;
      if(text.startsWith("www.")) urlText = "https://" + text;
      if(text.startsWith("youtu.be/")) urlText = "https://" + text;
      if(text.startsWith("youtube.com/")) urlText = "https://" + text;

      try{
        const u = new URL(urlText);

        // youtu.be/ID
        if(u.hostname.includes("youtu.be")){
          return u.pathname.split("/").filter(Boolean)[0] || null;
        }

        // watch?v=ID
        const v = u.searchParams.get("v");
        if(v) return v;

        // shorts/ID
        const m1 = u.pathname.match(/\/shorts\/([^/?#]+)/);
        if(m1) return m1[1];

        // embed/ID
        const m2 = u.pathname.match(/\/embed\/([^/?#]+)/);
        if(m2) return m2[1];

        return null;
      } catch(e){
        return null;
      }
    }

    function buildEmbed(id){
      const base = `https://www.youtube-nocookie.com/embed/${encodeURIComponent(id)}`;
      const params = new URLSearchParams({
        autoplay: "1",
        rel: "0",
        modestbranding: "1",
        playsinline: "1"
      });
      return base + "?" + params.toString();
    }

    btn.addEventListener("click", () => {
      console.log("Button clicked ✅");

      const id = extractId(input.value);
      if(!id){
        setStatus("الرابط غير صحيح أو لا يحتوي على معرف فيديو.", true);
        frame.src = "";
        return;
      }

      frame.src = buildEmbed(id);
      setStatus("تم تحميل الفيديو داخل الصفحة ✅");
    });

    // Enter لتشغيل
    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter") btn.click();
    });
  </script>
</body>
</html>