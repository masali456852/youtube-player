<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ØªØ´ØºÙŠÙ„ ÙˆØªØ­Ù…ÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ ÙŠÙˆØªÙŠÙˆØ¨</title>

  <style>
    body{font-family:Tahoma,Arial,sans-serif;background:#0b1020;color:#fff;margin:0;padding:20px}
    .box{max-width:900px;margin:auto;background:#121a33;border:1px solid rgba(255,255,255,.15);border-radius:14px;padding:16px}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(0,0,0,.25);color:#fff;outline:none}
    button{margin-top:10px;padding:11px 14px;border-radius:10px;border:0;background:#5b8cff;color:#07102a;font-weight:700;cursor:pointer}
    .msg{margin-top:10px;color:#a9b3d6;font-size:13px;line-height:1.8}
    .err{color:#ff5b6a}
    .player{margin-top:14px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.15);background:#000}
    .ratio{position:relative;padding-top:56.25%}
    iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

    .dl-box{margin-top:20px;background:#0f152b;padding:14px;border-radius:10px;display:none}
    .dl-item{margin:6px 0;padding:10px;background:#18203d;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
    a.dl-btn{color:#fff;background:#5b8cff;padding:6px 10px;border-radius:6px;text-decoration:none;font-weight:bold}
  </style>
</head>

<body>
  <div class="box">
    <h3 style="margin:0 0 10px">Ø¶Ø¹ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø«Ù… Ø§Ø¶ØºØ· ØªØ´ØºÙŠÙ„</h3>

    <input id="ytInput" placeholder="Ù…Ø«Ø§Ù„: https://youtu.be/dQw4w9WgXcQ" />
    <button id="playBtn" type="button">ØªØ´ØºÙŠÙ„</button>

    <div id="status" class="msg">Ø¬Ø§Ù‡Ø²â€¦</div>

    <div class="player">
      <div class="ratio">
        <iframe id="ytFrame"
          title="YouTube Player"
          loading="lazy"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </div>
    </div>

    <div id="downloadBox" class="dl-box">
      <h4>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©:</h4>
      <div id="dlList"></div>
    </div>

  </div>

<script>
console.log("JS Loaded âœ…");

const input  = document.getElementById("ytInput");
const btn    = document.getElementById("playBtn");
const status = document.getElementById("status");
const frame  = document.getElementById("ytFrame");
const dlBox  = document.getElementById("downloadBox");
const dlList = document.getElementById("dlList");

function setStatus(text, isError=false){
  status.textContent = text;
  status.className = isError ? "msg err" : "msg";
}

function extractId(raw){
  const text = (raw || "").trim();
  if(!text) return null;

  if(/^[a-zA-Z0-9_-]{11}$/.test(text)) return text;

  let urlText = text;
  if(text.startsWith("www.")) urlText = "https://" + text;
  if(text.startsWith("youtu.be/")) urlText = "https://" + text;
  if(text.startsWith("youtube.com/")) urlText = "https://" + text;

  try{
    const u = new URL(urlText);

    if(u.hostname.includes("youtu.be")){
      return u.pathname.split("/").filter(Boolean)[0] || null;
    }
    const v = u.searchParams.get("v");
    if(v) return v;

    const m1 = u.pathname.match(/\/shorts\/([^/?#]+)/);
    if(m1) return m1[1];

    const m2 = u.pathname.match(/\/embed\/([^/?#]+)/);
    if(m2) return m2[1];

    return null;
  } catch(e){
    return null;
  }
}

function buildEmbed(id){
  return `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&modestbranding=1&playsinline=1`;
}

// Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ø¨Ø± y2mate.ch
async function fetchDownloadLinks(id){
  const api = "https://api.y2mate.ch/api/convert";

  const body = {
    url: "https://www.youtube.com/watch?v=" + id
  };

  const res = await fetch(api, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(body)
  });

  const data = await res.json();

  if (!data || !data.formats) return [];

  return data.formats.map(f => ({
    quality: f.quality,
    format: f.ext,
    url: f.url
  }));
}

btn.addEventListener("click", async () => {

  const id = extractId(input.value);
  if(!id){
    setStatus("Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù ÙÙŠØ¯ÙŠÙˆ.", true);
    frame.src = "";
    dlBox.style.display = "none";
    return;
  }

  frame.src = buildEmbed(id);
  setStatus("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø© âœ…");

  setStatus("Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦");

  try{
    const qualities = await fetchDownloadLinks(id);

    dlList.innerHTML = "";
    dlBox.style.display = "block";

    qualities.forEach(q => {
      const item = document.createElement("div");
      item.className = "dl-item";

      item.innerHTML = `
        <span>${q.quality} â€” ${q.format}</span>
        <a class="dl-btn"
      `;
      dlList.appendChild(item);
    });

    setStatus("ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰");

  } catch(err){
    console.error(err);
    setStatus("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„.", true);
  }

});

// ØªØ´ØºÙŠÙ„ Ø¹Ø¨Ø± Enter
input.addEventListener("keydown", (e) => {
  if(e.key === "Enter") btn.click();
});
</script>

</body>
</html>
